<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>ELTT-Wallet – Souveräne Wallet-Sicht</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Souveräne Wallet-Sicht der ELTT-Blockchain. Deterministische, auditierbare und paritätische Wallet-Operationen.">
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header id="app-header">
        <div class="logo">
            <span class="logo-main">ELTT‑Blockchain</span>
            <span class="logo-sub">Wallet · Souveräne Adresse</span>
        </div>
        <nav id="main-nav">
            <a href="../ELTT-Blockchain.html" data-nav="chain">Blockchain</a>
            <a href="ELTT-wallet.html" data-nav="wallet">Wallet</a>
            <a href="ELTT-wallet/ELTT-launcher.html" data-nav="launcher">Launcher / DEX</a>
            <a href="ELTT-wallet/ELTT-liquidity-pools.html" data-nav="pools">Liquidity‑Pools</a>
            <a href="ELTT-Viewer.html" data-nav="viewer">Viewer</a>
        </nav>
    </header>

    <main id="app-main">
        <section id="wallet-intro">
            <h2>Wallet‑Souveränität</h2>
            <p>
                Diese Ansicht arbeitet ausschließlich mit einer im Frontend erzeugten Adresse.
                Die Owner‑Wallet entsteht aus einer 12‑Wort‑Phrase im Frontend, ist die einzige Genesis‑Wallet,
                besitzt TTTC, ELTT und ELTC, erzeugt Block&nbsp;2 autonom und ist Ursprung aller Extensions.
                Im Backend ist keine Adresse, kein Seed und kein privater Schlüssel hinterlegt.
            </p>
        </section>

        <section id="wallet-address-section">
            <h2>Aktuelle Wallet‑Adresse</h2>
            <div class="wallet-address-row">
                <input id="wallet-address-input" type="text" placeholder="Adresse der Wallet eingeben" autocomplete="off">
                <button id="wallet-set-address-btn" class="btn">Adresse setzen</button>
            </div>
            <p class="note">
                Die Adresse wird deterministisch im Frontend verwaltet. Diese Seite speichert keine Seeds
                und keine privaten Schlüssel.
            </p>
        </section>

        <section id="wallet-state-section">
            <h2>Token‑Bestände</h2>
            <div id="wallet-state-empty" class="note">
                Noch keine Wallet‑Adresse gesetzt oder keine Daten verfügbar.
            </div>
            <table id="wallet-state-table" style="width:100%; border-collapse:collapse; display:none; font-size:0.85rem;">
                <thead>
                    <tr>
                        <th style="text-align:left; padding:6px 4px;">Symbol</th>
                        <th style="text-align:left; padding:6px 4px;">Name</th>
                        <th style="text-align:left; padding:6px 4px;">Typ</th>
                        <th style="text-align:right; padding:6px 4px;">Balance</th>
                    </tr>
                </thead>
                <tbody id="wallet-state-tbody"></tbody>
            </table>
        </section>

        <section id="wallet-transfer-section">
            <h2>Deterministischer Transfer</h2>
            <div class="wallet-transfer-grid">
                <div class="wallet-transfer-field">
                    <label for="transfer-to">Zieladresse</label>
                    <input id="transfer-to" type="text" placeholder="Zieladresse" autocomplete="off">
                </div>
                <div class="wallet-transfer-field">
                    <label for="transfer-amount">Betrag</label>
                    <input id="transfer-amount" type="number" step="0.00000001" min="0" placeholder="0.0">
                </div>
                <div class="wallet-transfer-field">
                    <label for="transfer-token-index">Token‑Index</label>
                    <input id="transfer-token-index" type="number" step="1" min="0" placeholder="0">
                </div>
                <div class="wallet-transfer-field">
                    <label for="transfer-memo">Memo (optional, max. 128 Zeichen)</label>
                    <input id="transfer-memo" type="text" maxlength="128" placeholder="">
                </div>
            </div>
            <div class="wallet-transfer-actions">
                <button id="transfer-build-btn" class="btn">Transfer‑TX deterministisch erzeugen</button>
            </div>
            <pre id="transfer-tx-output" style="margin-top:10px; padding:8px; border-radius:8px; background:#020617; border:1px solid #1f2937; font-size:0.8rem; overflow-x:auto; display:none;"></pre>
        </section>
    </main>

    <footer id="app-footer">
        <p>ELTT‑Wallet · Deterministisch · Auditierbar · Souverän</p>
    </footer>

    <script src="../assets/js/ui.js"></script>
    <script src="../assets/js/ELTT-Blockchain.js"></script>
    <script src="../assets/js/ELTT-wallet.js"></script>
    <script>
        (function () {
            const addressInput = document.getElementById("wallet-address-input");
            const setAddressBtn = document.getElementById("wallet-set-address-btn");
            const stateEmpty = document.getElementById("wallet-state-empty");
            const stateTable = document.getElementById("wallet-state-table");
            const stateTbody = document.getElementById("wallet-state-tbody");

            const transferTo = document.getElementById("transfer-to");
            const transferAmount = document.getElementById("transfer-amount");
            const transferTokenIndex = document.getElementById("transfer-token-index");
            const transferMemo = document.getElementById("transfer-memo");
            const transferBuildBtn = document.getElementById("transfer-build-btn");
            const transferTxOutput = document.getElementById("transfer-tx-output");

            function renderWalletState() {
                const addr = window.ELTTWallet.getCurrentWalletAddress();
                if (!addr) {
                    stateEmpty.style.display = "block";
                    stateTable.style.display = "none";
                    stateTbody.innerHTML = "";
                    return;
                }
                const state = window.ELTTWallet.getWalletState(addr);
                if (!state || !state.tokens || state.tokens.length === 0) {
                    stateEmpty.style.display = "block";
                    stateTable.style.display = "none";
                    stateTbody.innerHTML = "";
                    return;
                }
                stateEmpty.style.display = "none";
                stateTable.style.display = "table";
                stateTbody.innerHTML = "";
                state.tokens.forEach((t) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td style="padding:4px;">${t.symbol}</td>
                        <td style="padding:4px;">${t.name}</td>
                        <td style="padding:4px;">${t.kind}</td>
                        <td style="padding:4px; text-align:right;">${t.balance}</td>
                    `;
                    stateTbody.appendChild(tr);
                });
            }

            function onSetAddress() {
                const addr = (addressInput.value || "").trim();
                if (!addr) {
                    return;
                }
                window.ELTTWallet.setCurrentWalletAddress(addr);
                renderWalletState();
            }

            function onBuildTransfer() {
                const to = (transferTo.value || "").trim();
                const amount = parseFloat(transferAmount.value || "0");
                const tokenIndex = parseInt(transferTokenIndex.value || "0", 10);
                const memo = transferMemo.value || "";

                if (!to || !Number.isFinite(amount) || amount <= 0 || !Number.isInteger(tokenIndex) || tokenIndex < 0) {
                    return;
                }

                try {
                    const tx = window.ELTTWallet.buildDeterministicTransfer(
                        to,
                        amount,
                        tokenIndex,
                        memo
                    );
                    transferTxOutput.style.display = "block";
                    transferTxOutput.textContent = JSON.stringify(tx, null, 2);
                } catch (e) {
                    transferTxOutput.style.display = "block";
                    transferTxOutput.textContent = String(e);
                }
            }

            setAddressBtn.addEventListener("click", onSetAddress);
            addressInput.addEventListener("keydown", (ev) => {
                if (ev.key === "Enter") {
                    onSetAddress();
                }
            });

            transferBuildBtn.addEventListener("click", onBuildTransfer);
        })();
    </script>
    <script src="../BUTTONS/wallet-buttons.js"></script>
</body>
</html>
